{% extends 'base.html' %}
{% load i18n %}
{% load static %}
{% load bootstrap5 bootstrap_icons %}
{% load is_bartender not_answered first_file %}

{% block content %}

{% include 'common-events.html' %}

<div class="row">
    <div class="col-auto">
        <h2 id="bartender-events">
			{% translate "Bartender events" %}
			<a href="#bartender-events" class="section-link">#</a>
		</h2>
    </div>
    <div class="col text-end">
        <a class="btn btn-outline-info btn-sm" href="{% url 'event_feed' %}" role="button">
            {% bs_icon 'calendar-week' %} iCal feed
        </a>
    </div>
</div>

<div class="row m-2">
	<hr>
	<ul class="timeline">
		{% if event_page_obj.has_previous %}
			<li>
				<div>
					<p></p>
				</div>
			</li>
			<li class="timeline-item">
				<div>
					<p>
						<a class="btn btn-outline-primary btn-sm" href="?events_per_page={{ events_per_page }}&event_page={{ event_page_obj.previous_page_number }}">{% translate "Vis nyere" %}</a>
					</p>
				</div>
			</li>
		{% endif %}
		{% for events_data in events_data %}
			{% with events_data.event as event %}
			{% if events_data.year %}
			<li class="timeline-item mb-3">
				{{ events_data.year }}
			</li>
			{% endif %}
			<li class="timeline-item mb-3">
				<div class="col-lg-6 mb-2">
					<div class="card card-hover">
						{% if album.bartenderalbum and not user|is_bartender %}
						{% else %}
							{% with firstFile=event.event_album|first_file %}
							{% if event.event_album.thumbnail %}
								<img src="{{ event.event_album.thumbnail.url }}" class="card-img-top event-image" alt="{{ event.name }}">
							{% elif firstFile %}
								{% if firstFile.type == "I" %}
								<img src="{{ firstFile.file.crop.940x940.url }}" class="card-img-top event-image" alt="{{ event.name }}">
								{% else %}
								<img src="{% static "images/logo.png" %}" class="card-img-top event-image" alt="{{ event.name }}">
								{% endif %}
							{% endif %}
							{% endwith %}
						{% endif %}
						<div class="card-body">
							<h4 class="card-title">
								{{ event.name }}
								{% if user|not_answered:event %}
									<i class="text-primary">{% bs_icon 'circle-fill' size='0.5em' %}</i>
									<span class="visually-hidden">{% translate "Not answered" %}</span>
								{% endif %}
							</h4>
							<p class="card-text mb-1">
								{% bs_icon 'calendar-event-fill' size='1.1em' %} <b>{{ event.start_datetime }}</b> {% translate "til" %} <b>{{ event.end_datetime }}</b>.<br>
								{% bs_icon 'geo-alt-fill' size='1.1em' %} {{ event.location }}<br>
								{% bs_icon 'people-fill' size='1.1em' %} {{ event.attending_count }}
							</p>
							<a href="{{ event.id }}" class="card-link stretched-link"></a>
						</div>
						{% if not event.deadline_exceeded %}
							<div class="card-footer">
								<small class="text-body-secondary">
									<b>{% translate "Tilmeldingsfrist" %}:</b>
									{{ event.response_deadline }}
									{% if event.deadline_exceeded %} ({% translate "for sent" %}){% endif %}
								</small>
							</div>
						{% endif %}
					</div>
				</div>
			</li>
			{% endwith %}
		{% empty %}
			<li class="timeline-item">
				<div>
					<p>{% translate "Ingen events endnu." %}</p>
				</div>
			</li>
		{% endfor %}
		<li class="timeline-item">
			<div>
				<p>
					{% if event_page_obj.has_next %}
						<a class="btn btn-outline-primary btn-sm" href="?events_per_page={{ events_per_page }}&event_page={{ event_page_obj.next_page_number }}">{% translate "Vis tidligere" %}</a>
					{% endif %}
				</p>
			</div>
		</li>
	</ul>
</div>

{% endblock %}
