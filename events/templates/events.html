{% extends 'base.html' %}
{% load i18n %}
{% load static %}
{% load bootstrap5 bootstrap_icons %}
{% load is_bartender not_answered first_file %}

{% block content %}

<h2 id="events">
	{% translate "Kommende events" %}
	<a href="#events" class="section-link">#</a>
</h2>

{% for event in events %}
<div class="row">
    <div class="col-xs-12 visible-xs-block">
        <h4>
            {{ event.title }}
            {% if event.facebook %}
            <a href="{{ event.facebook }}" class="text-primary-emphasis" target="_blank" rel="external">
                {% bs_icon 'facebook' size='1.35em' %}
            </a>
            {% endif %}
            <span class="pull-right">
                <small>
                    {{ event.date }}
                </small>
            </span>
        </h4>
    </div>
    <div class="col-sm-4 hidden-xs col-lg-offset-1">
        <h4>
            {{ event.title }}
            {% if event.facebook %}
            <a href="{{ event.facebook }}" class="cal-facebook-icon">
                <svg version="1.1" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
                    <path d="M18.768,7.465H14.5V5.56c0-0.896,0.594-1.105,1.012-1.105s2.988,0,2.988,0V0.513L14.171,0.5C10.244,0.5,9.5,3.438,9.5,5.32 v2.145h-3v4h3c0,5.212,0,12,0,12h5c0,0,0-6.85,0-12h3.851L18.768,7.465z"/>
                </svg>
            </a>
            {% endif %}
        <br/>
        <small>
            {{ event.date }}
        </small>
        </h4>
    </div>
    <div class="col-xs-12 col-sm-8 col-lg-6">
        <div class="hidden-xs cal-baseline-fix"></div>
        <p class="">
            {{ event.description }}
        </p>
    </div>
</div>
{% endfor %}

<div class="mb-2">
	<a class="btn btn-outline-info btn-sm" href="{% url 'event_feed' %}" role="button">
		{% bs_icon 'calendar-week' %} iCal feed
	</a>
</div>

<h2 id="bartender-events">
	{% translate "Bartender events" %}
	<a href="#bartender-events" class="section-link">#</a>
</h2>

<div class="row m-2">
	<ul class="timeline">
		{% if event_page_obj.has_previous %}
			<li>
				<div>
					<p></p>
				</div>
			</li>
			<li class="timeline-item">
				<div>
					<p>
						<a class="btn btn-outline-primary btn-sm" href="?events_per_page={{ events_per_page }}&event_page={{ event_page_obj.previous_page_number }}">{% translate "Vis nyere" %}</a>
					</p>
				</div>
			</li>
		{% endif %}
		{% for events_data in events_data %}
			{% with events_data.event as event %}
			{% if events_data.year %}
			<li class="timeline-item mb-3">
				{{ events_data.year }}
			</li>
			{% endif %}
			<li class="timeline-item mb-3">
				<div class="col-lg-6 mb-2">
					<div class="card card-hover">
						{% if album.bartenderalbum and not user|is_bartender %}
						{% else %}
							{% with firstFile=event.event_album|first_file %}
							{% if event.event_album.thumbnail %}
								<img src="{{ event.event_album.thumbnail.url }}" class="card-img-top event-image" alt="{{ event.name }}">
							{% elif firstFile %}
								{% if firstFile.type == "I" %}
								<img src="{{ firstFile.file.crop.940x940.url }}" class="card-img-top event-image" alt="{{ event.name }}">
								{% else %}
								<img src="{% static "images/logo.png" %}" class="card-img-top event-image" alt="{{ event.name }}">
								{% endif %}
							{% endif %}
							{% endwith %}
						{% endif %}
						<div class="card-body">
							<h4 class="card-title">
								{{ event.name }}
								{% if user|not_answered:event %}
									<i class="text-primary">{% bs_icon 'circle-fill' size='0.5em' %}</i>
									<span class="visually-hidden">{% translate "Not answered" %}</span>
								{% endif %}
							</h4>
							<p class="card-text mb-1">
								{% bs_icon 'calendar-event-fill' size='1.1em' %} <b>{{ event.start_datetime }}</b> {% translate "til" %} <b>{{ event.end_datetime }}</b>.<br>
								{% bs_icon 'geo-alt-fill' size='1.1em' %} {{ event.location }}<br>
								{% bs_icon 'people-fill' size='1.1em' %} {{ event.attending_count }}
							</p>
							<a href="{{ event.id }}" class="card-link stretched-link"></a>
						</div>
						{% if not event.deadline_exceeded %}
							<div class="card-footer">
								<small class="text-body-secondary">
									<b>{% translate "Tilmeldingsfrist" %}:</b>
									{{ event.response_deadline }}
									{% if event.deadline_exceeded %} ({% translate "for sent" %}){% endif %}
								</small>
							</div>
						{% endif %}
					</div>
				</div>
			</li>
			{% endwith %}
		{% empty %}
			<li class="timeline-item">
				<div>
					<p>{% translate "Ingen events endnu." %}</p>
				</div>
			</li>
		{% endfor %}
		<li class="timeline-item">
			<div>
				<p>
					{% if event_page_obj.has_next %}
						<a class="btn btn-outline-primary btn-sm" href="?events_per_page={{ events_per_page }}&event_page={{ event_page_obj.next_page_number }}">{% translate "Vis tidligere" %}</a>
					{% endif %}
				</p>
			</div>
		</li>
	</ul>
</div>

<div class="mb-2">
	<a class="btn btn-outline-info btn-sm" href="{% url 'event_feed' %}" role="button">
		{% bs_icon 'calendar-week' %} iCal feed
	</a>
</div>

{% endblock %}
